<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GPS Veh칤culos</title>
</head>
<body>
  <h2>Consulta de Geoposici칩n</h2>
  <div id="mensaje">Consultando datos...</div>

  <script>
    // 游녤 1. Obtener el par치metro id de la URL
    function getParameterByName(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    const vehiculoId = getParameterByName("id");
    const mensaje = document.getElementById("mensaje");

    if (!vehiculoId) {
      mensaje.textContent = "Error: No se proporcion칩 un ID de veh칤culo en la URL.";
    } else {
      mensaje.textContent = `Buscando posici칩n del veh칤culo con ID: ${vehiculoId}...`;

      // 游녤 2. Llamada al servicio web con fetch
      const apiUrl = `http://gps14.geolocaliza.com/gps/ws.php?wsKeyGrupo=still&wsAcc=vl&id=${vehiculoId}&format=json`;

      fetch(apiUrl)
        .then(response => {
          if (!response.ok) throw new Error("Error al conectar con el servicio web");
          return response.json();
        })
        .then(data => {
          console.log("Respuesta API:", data);

          // 游녤 3. Validar la estructura del JSON
          if (!data || !data.lat || !data.long) {
            throw new Error("La respuesta no contiene lat/long");
          }

          const lat = data.lat;
          const lon = data.long;

          mensaje.textContent = `Veh칤culo ${vehiculoId}: Lat=${lat}, Long=${lon}`;

          // 游녤 4. Abrir Google Maps en una nueva pesta침a
          const mapsUrl = `https://www.google.com/maps?q=${lat},${lon}`;
          window.open(mapsUrl, "_blank");
        })
        .catch(error => {
          console.error("Error:", error);
          mensaje.textContent = "Error al obtener la posici칩n: " + error.message;
        });
    }
  </script>
</body>
</html>
