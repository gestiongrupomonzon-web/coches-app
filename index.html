<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Vehículo GPS</title>
</head>
<body>

<h2>Obteniendo ubicación del vehículo...</h2>

<script>
  // Función para leer el parámetro 'id' de la URL
  function obtenerParametro(nombre) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(nombre);
  }

  // Función para obtener la geoposición del vehículo
  async function obtenerPosicionVehiculo(id) {
    if (!id) {
      alert("No se proporcionó ID del vehículo en la URL");
      return;
    }

    try {
      // URL del servicio web de geoposición
      const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`http://gps14.geolocaliza.com/gps/ws.php?wsKeyGrupo=still&wsAcc=vl&id=${id}&format=json`)}`;
      
      const response = await fetch(url);
      if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);

      const data = await response.json();
      const gpsData = JSON.parse(data.contents);

      if (!gpsData.lat || !gpsData.long) {
        alert("No se pudo obtener la posición GPS del vehículo");
        return;
      }

      // Guardar posición en localStorage
      localStorage.setItem('ultimaPosicion', JSON.stringify({ lat: gpsData.lat, long: gpsData.long }));

      // Abrir Google Maps con la posición
      const mapsUrl = `https://www.google.com/maps?q=${gpsData.lat},${gpsData.long}`;
      window.open(mapsUrl, "_blank");

    } catch (err) {
      console.error("Error al obtener la posición:", err);
      alert("Error al obtener la posición GPS");
    }
  }

  // Ejecutar al cargar la página
  window.onload = function() {
    const idVehiculo = obtenerParametro('id');
    obtenerPosicionVehiculo(idVehiculo);
  };
</script>

</body>
</html>


